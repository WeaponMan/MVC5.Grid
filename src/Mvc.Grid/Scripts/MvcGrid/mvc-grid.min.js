/*!
 * Mvc.Grid 5.0.0
 * https://github.com/NonFactors/MVC5.Grid
 *
 * Copyright Â© NonFactors
 *
 * Licensed under the terms of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */
function MvcGridExtends(n,t){function i(){this.constructor=n}Object.setPrototypeOf(n,t);n.prototype=(i.prototype=t.prototype,new i)}var MvcGrid=function(){function n(n,t){var f,o,e,s,r,u,i;if(this.columns=[],this.element=n,t=t||{},this.data=t.data,this.name=n.attr("id")||"",this.rowClicked=t.rowClicked,this.methods={reload:this.reload},this.reloadEnded=t.reloadEnded,this.loadingDelay=t.loadingDelay,this.reloadFailed=t.reloadFailed,this.reloadStarted=t.reloadStarted,this.requestType=t.requestType||"get",this.prefix=this.name==""?"":this.name+"-",this.filterMode=n.data("filter-mode")||"ExcelRow",this.sourceUrl=t.sourceUrl||n.data("source-url")||"",this.showLoading=t.showLoading==null||t.showLoading,this.filters=$.extend({text:new MvcGridTextFilter,date:new MvcGridDateFilter,number:new MvcGridNumberFilter,boolean:new MvcGridBooleanFilter},t.filters),this.sourceUrl?(f=this.sourceUrl.indexOf("?"),f>-1?(this.query=this.sourceUrl.substring(f+1),this.sourceUrl=this.sourceUrl.substring(0,f)):this.query=t.query||""):this.query=window.location.search.replace("?",""),o=!this.sourceUrl||(t.isLoaded==null?n.children().length>0:t.isLoaded),t.reload||!o){this.reload();return}for(e=n.find(".mvc-grid-headers th"),s=n.find(".mvc-grid-row-filters th"),r=0;r<e.length;r++)u=this.createColumn($(e[r]),s[r]),this.bindFilter(u),this.bindSort(u),this.cleanup(u),this.columns.push(u);i=n.find(".mvc-grid-pager");i.length>0&&(this.pager={currentPage:i.find("li.active").data("page")||0,showPageSizes:i.data("show-page-sizes")=="True",rowsPerPage:i.find(".mvc-grid-pager-rows"),pages:i.find("li:not(.disabled)"),element:i});this.bindPager();this.bindGrid();this.clean()}return n.prototype={createColumn:function(n,t){var i={};return i.header=n,i.rowFilter=t,i.name=n.data("name")||"",n.data("filter")=="True"&&(i.filter={isMulti:n.data("filter-multi")=="True",operator:n.data("filter-operator")||"",name:n.data("filter-name")||"",first:{method:n.data("filter-first-method")||"",value:n.data("filter-first-value")||"",isInline:this.filterMode!="ExcelRow"},second:{method:n.data("filter-second-method")||"",value:n.data("filter-second-value")||"",isInline:this.filterMode!="ExcelRow"}}),n.data("sort")=="True"&&this.filterMode!="HeaderRow"&&(i.sort={firstOrder:n.data("sort-first")||"",order:n.data("sort-order")||""}),i},set:function(n){for(var t in n)this.hasOwnProperty(t)&&(t=="filters"?this.filters=$.extend(this.filters,n.filters):t=="sourceUrl"?(n.hasOwnProperty("query")||(this.query=""),this.sourceUrl=n.sourceUrl):this[t]=n[t]);n.reload&&this.reload()},bindFilter:function(n){var u,i;if(n.filter&&this.filters[n.filter.name]){var r=this,t=this.filters[n.filter.name],f=$("body").children(".mvc-grid-popup");$(n.rowFilter||n.header[0]).find(".mvc-grid-filter").on("click.mvcgrid",function(i){i.preventDefault();r.renderFilter(n,t)});$(n.rowFilter).find(".mvc-grid-value").on("keyup.mvcgrid",function(i){t.isValid(this.value)?($(this).removeClass("invalid"),i.which==13&&t.apply(r,n,f)):$(this).addClass("invalid")});u=$(n.rowFilter).find(".mvc-grid-method");u.val()==""&&u.val(t.methods[0]);i=$(n.rowFilter).find(".mvc-grid-value");i.length&&!t.isValid(i.val())&&i.addClass("invalid");t.initRowFilter&&t.initRowFilter(r,n,f)}},bindSort:function(n){if(n.sort){var t=this;n.header.on("click.mvcgrid",function(i){var r=$(i.target||i.srcElement);r.hasClass("mvc-grid-filter")||r.parents(".mvc-grid-filter").length!=0||(t.applySort(n),t.reload())})}},bindPager:function(){var n=this;if(n.pager){n.pager.rowsPerPage.on("change.mvcgrid",function(){n.applyPage(n.pager.currentPage);n.reload()});n.pager.pages.on("click.mvcgrid","a",function(t){t.preventDefault();var i=$(this).data("page");i&&(n.applyPage(i),n.reload())})}},bindGrid:function(){var n=this;n.element.find("tbody tr:not(.mvc-grid-empty-row)").on("click.mvcgrid",function(t){for(var f,u=$(this).find("td"),r=[],i=0;i<n.columns.length;i++)f=n.columns[i],i<u.length&&(r[f.name]=$(u[i]).text());n.rowClicked&&n.rowClicked(this,r,t);$(this).trigger("rowclick",[r,n,t])})},reload:function(){var n=this;n.element.trigger("reloadStarted",[n]);n.reloadStarted&&n.reloadStarted();n.sourceUrl?(n.startLoading(),$.ajax({cache:!1,data:n.data,type:n.requestType,url:n.sourceUrl+"?"+n.query}).done(function(t){var r=$(t),i;n.element.replaceWith(r);i=r.mvcgrid({reloadStarted:n.reloadStarted,reloadFailed:n.reloadFailed,loadingDelay:n.loadingDelay,reloadEnded:n.reloadEnded,showLoading:n.showLoading,requestType:n.requestType,rowClicked:n.rowClicked,sourceUrl:n.sourceUrl,filters:n.filters,query:n.query,data:n.data,isLoaded:!0}).data("mvc-grid");i.element.trigger("reloadEnded",[i]);i.reloadEnded&&i.reloadEnded()}).fail(function(t){n.element.trigger("reloadFailed",[n,t]);n.reloadFailed&&n.reloadFailed(t)})):window.location.href="?"+n.query},renderFilter:function(n,t){var r=this,i=$("body").children(".mvc-grid-popup");$(window).off("resize.mvcgrid");$(window).off("click.mvcgrid");t.render(r,i,n.filter);t.init(r,n,i);r.setFilterPosition(n,i);i.addClass("open");$(window).on("click.mvcgrid",function(n){var t=$(n.target||n.srcElement);t.hasClass("mvc-grid-filter")||t.parents(".mvc-grid-popup").length!=0||t.is('[class*="ui-datepicker"]')||t.parents('[class*="ui-datepicker"]').length!=0||($(window).off("click.mvcgrid"),i.removeClass("open"))});$(window).on("resize.mvcgrid",function(){i.hasClass("open")&&(i.removeClass("open"),r.setFilterPosition(n,i),i.addClass("open"))})},setFilterPosition:function(n,t){var i=$(n.rowFilter||n.header[0]).find(".mvc-grid-filter"),f=$(document).width(),s=t.find(".popup-arrow"),e=t.width(),h=i.offset().top+i.height()/2+14,r=i.offset().left-8,o=i.width()/2,u;r+e+13>f&&(u=r-(f-e-5),r-=u,o+=u);s.css("left",o+"px");t.css("left",r+"px");t.css("top",h+"px")},startLoading:function(){if(this.showLoading&&!this.element.children(".mvc-grid-loader").length){var n=$('<div class="mvc-grid-loader"><div><div class="p-1"><\/div><div class="p-2"><\/div><div class="p-3"><\/div><\/div><\/div>');setTimeout(function(){n.addClass("mvc-grid-loading")},this.loadingDelay==null?300:this.loadingDelay);this.element.append(n)}},cancelFilter:function(n){this.queryRemove(this.prefix+"page");this.queryRemove(this.prefix+"rows");this.queryRemoveStartingWith(this.prefix+n.name+"-")},applyFilter:function(n){this.cancelFilter(n);this.queryAdd(this.prefix+n.name+"-"+n.filter.first.method,n.filter.first.value);n.filter.isMulti&&(this.queryAdd(this.prefix+n.name+"-op",n.filter.operator),this.queryAdd(this.prefix+n.name+"-"+n.filter.second.method,n.filter.second.value));this.pager&&this.pager.showPageSizes&&this.queryAdd(this.prefix+"rows",this.pager.rowsPerPage.val())},applySort:function(n){this.queryRemove(this.prefix+"sort");this.queryRemove(this.prefix+"order");this.queryAdd(this.prefix+"sort",n.name);var t=n.sort.order=="asc"?"desc":"asc";!n.sort.order&&n.sort.firstOrder&&(t=n.sort.firstOrder);this.queryAdd(this.prefix+"order",t)},applyPage:function(n){this.queryRemove(this.prefix+"page");this.queryRemove(this.prefix+"rows");this.queryAdd(this.prefix+"page",n);this.pager.showPageSizes&&this.queryAdd(this.prefix+"rows",this.pager.rowsPerPage.val())},queryAdd:function(n,t){this.query+=(this.query?"&":"")+encodeURIComponent(n)+"="+encodeURIComponent(t)},queryRemoveStartingWith:function(n){for(var u,f=encodeURIComponent(n),i=this.query.split("&"),r=[],t=0;t<i.length;t++)u=i[t].split("=")[0],i[t]&&u.indexOf(f)!=0&&r.push(i[t]);this.query=r.join("&")},queryRemove:function(n){for(var u,f=encodeURIComponent(n),i=this.query.split("&"),r=[],t=0;t<i.length;t++)u=i[t].split("=")[0],i[t]&&u!=f&&r.push(i[t]);this.query=r.join("&")},cleanup:function(n){var t=n.header;t.removeAttr("data-name");t.removeAttr("data-filter");t.removeAttr("data-filter-name");t.removeAttr("data-filter-multi");t.removeAttr("data-filter-operator");t.removeAttr("data-filter-first-value");t.removeAttr("data-filter-first-method");t.removeAttr("data-filter-second-value");t.removeAttr("data-filter-second-method");t.removeAttr("data-sort");t.removeAttr("data-sort-order");t.removeAttr("data-sort-first")},clean:function(){this.element.removeAttr("data-filter-mode");this.element.removeAttr("data-source-url");this.pager&&this.pager.element.removeAttr("data-show-page-sizes")}},n}(),MvcGridFilter=function(){function n(){this.methods=[]}return n.prototype={render:function(n,t,i){t.html('<div class="popup-arrow"><\/div><div class="popup-content"><div class="first-filter">'+this.renderFilter(i.first)+"<\/div>"+(i.isMulti?this.renderOperator(i,$.fn.mvcgrid.lang.operator)+'<div class="second-filter">'+this.renderFilter(i.second)+"<\/div>":"")+this.renderActions($.fn.mvcgrid.lang.filter)+"<\/div>")},renderFilter:function(n,t){var i=this.methods.reduce(function(i,r){return i+'<option value="'+r+'"'+(n.method==r?' selected="selected"':"")+">"+t[r]+"<\/option>"},"");return'<div class="popup-group"><select class="mvc-grid-method">'+i+"<\/select><\/div>"+(n.isInline?"":'<div class="popup-group"><input class="mvc-grid-value" value="'+n.value+'" /><\/div>')},renderOperator:function(n,t){return'<div class="operator-filter"><div class="popup-group"><select class="mvc-grid-operator"><option value="">'+t.select+'<\/option><option value="and"'+(n.operator=="and"?' selected="selected"':"")+">"+t.and+'<\/option><option value="or"'+(n.operator=="or"?' selected="selected"':"")+">"+t.or+"<\/option><\/select><\/div><\/div>"},renderActions:function(n){return'<div class="filter-actions"><button class="mvc-grid-apply" type="button">'+n.apply+'<\/button><button class="mvc-grid-cancel" type="button">'+n.remove+"<\/button><\/div>"},init:function(n,t,i){this.bindMethod(n,t,i);this.bindValue(n,t,i);this.bindApply(n,t,i);this.bindCancel(n,t,i)},initRowFilter:function(){},bindMethod:function(n,t,i){i.find(".mvc-grid-method").on("change.mvcgrid",function(){$(t.rowFilter).find(".mvc-grid-method").val(this.value)})},bindValue:function(n,t,i){var f=this,u=i.find(".mvc-grid-value"),r;u.on("keyup.mvcgrid",function(r){f.isValid(this.value)?($(this).removeClass("invalid"),r.which==13&&f.apply(n,t,i)):$(this).addClass("invalid")});for(r=0;r<u.length;r++)f.isValid(u[r].value)||$(u[r]).addClass("invalid")},bindApply:function(n,t,i){var r=this;i.find(".mvc-grid-apply").on("click.mvcgrid",function(){r.apply(n,t,i)})},bindCancel:function(n,t,i){var r=this;i.find(".mvc-grid-cancel").on("click.mvcgrid",function(){r.cancel(n,t,i)})},isValid:function(){return!0},apply:function(n,t,i){i.removeClass("open");var r=$(t.rowFilter||i);t.filter.operator=r.find(".mvc-grid-operator").val();t.filter.first.method=r.find(".first-filter .mvc-grid-method").val()||this.methods[0];t.filter.first.value=r.find(".first-filter .mvc-grid-value").val();t.filter.second.method=r.find(".second-filter .mvc-grid-method").val();t.filter.second.value=r.find(".second-filter .mvc-grid-value").val();n.applyFilter(t);n.reload()},cancel:function(n,t,i){i.removeClass("open");(t.filter.first.method||t.filter.second.method)&&(n.cancelFilter(t),n.reload())}},n}(),MvcGridTextFilter=function(n){function t(){n.apply(this);this.methods=["contains","equals","not-equals","starts-with","ends-with"]}return MvcGridExtends(t,n),t.prototype.renderFilter=function(t){return n.prototype.renderFilter.call(this,t,$.fn.mvcgrid.lang.text)},t}(MvcGridFilter),MvcGridNumberFilter=function(n){function t(){n.apply(this);this.methods=["equals","not-equals","less-than","greater-than","less-than-or-equal","greater-than-or-equal"]}return MvcGridExtends(t,n),t.prototype.renderFilter=function(t){return n.prototype.renderFilter.call(this,t,$.fn.mvcgrid.lang.number)},t.prototype.isValid=function(n){return!n||/^(?=.*\d+.*)[-+]?\d*[.,]?\d*$/.test(n)},t}(MvcGridFilter),MvcGridDateFilter=function(n){function t(){n.apply(this);this.methods=["equals","not-equals","earlier-than","later-than","earlier-than-or-equal","later-than-or-equal"]}return MvcGridExtends(t,n),t.prototype.renderFilter=function(t){return n.prototype.renderFilter.call(this,t,$.fn.mvcgrid.lang.date)},t.prototype.initRowFilter=function(n,t,i){var r=this;$.fn.datepicker&&$(t.rowFilter).find(".mvc-grid-value").datepicker({onSelect:function(u,f){u!=f.lastVal&&r.apply(n,t,i)}})},t.prototype.bindValue=function(t,i,r){$.fn.datepicker&&r.find(".mvc-grid-value").datepicker();n.prototype.bindValue.call(this,t,i,r)},t}(MvcGridFilter),MvcGridBooleanFilter=function(n){function t(){n.apply(this);this.methods=["true","false"]}return MvcGridExtends(t,n),t.prototype.renderFilter=function(n){var t=$.fn.mvcgrid.lang.boolean;return'<div class="popup-group"><ul class="mvc-grid-boolean-filter"><li '+(n.value=="True"?'class="active" ':"")+'data-value="True">'+t.true+"<\/li><li "+(n.value=="False"?'class="active" ':"")+'data-value="False">'+t.false+"<\/li><\/ul><\/div>"},t.prototype.initRowFilter=function(n,t){$(t.rowFilter).find(".mvc-grid-value").attr("readonly","readonly")},t.prototype.bindValue=function(n,t,i){i.find("li").on("click.mvcgrid",function(){$(this).addClass("active").siblings().removeClass("active")})},t.prototype.apply=function(n,t,i){i.removeClass("open");t.filter.first.method="equals";t.filter.second.method="equals";t.filter.operator=i.find(".mvc-grid-operator").val();t.filter.first.value=i.find(".first-filter li.active").data("value");t.filter.second.value=i.find(".second-filter li.active").data("value");n.applyFilter(t);n.reload()},t}(MvcGridFilter);$.fn.mvcgrid=function(n){var f=arguments,i,r,t,u;if(n==="instance"){for(i=[],r=0;r<this.length;r++)(t=$(this[r]).closest(".mvc-grid"),t.length)&&(u=t.data("mvc-grid"),u||t.data("mvc-grid",u=new MvcGrid(t,n)),i.push(u));return this.length<=1?i[0]:i}return this.each(function(){var i=$(this).closest(".mvc-grid"),t;i.length&&(t=i.data("mvc-grid"),t?typeof n=="string"?t.methods[n].apply(t,[].slice.call(f,1)):n&&t.set(n):(typeof n=="string"?(t=new MvcGrid(i),t.methods[n].apply(t,[].slice.call(f,1))):t=new MvcGrid(i,n),$.data(i[0],"mvc-grid",t)))})};$.fn.mvcgrid.lang={text:{contains:"Contains",equals:"Equals","not-equals":"Not equals","starts-with":"Starts with","ends-with":"Ends with"},number:{equals:"Equals","not-equals":"Not equals","less-than":"Less than","greater-than":"Greater than","less-than-or-equal":"Less than or equal","greater-than-or-equal":"Greater than or equal"},date:{equals:"Equals","not-equals":"Not equals","earlier-than":"Earlier than","later-than":"Later than","earlier-than-or-equal":"Earlier than or equal","later-than-or-equal":"Later than or equal"},boolean:{"true":"Yes","false":"No"},filter:{apply:"&#10004;",remove:"&#10008;"},operator:{select:"",and:"and",or:"or"}};$(function(){$("body").append('<div class="mvc-grid-popup"><\/div>')});